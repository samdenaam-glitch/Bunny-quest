<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#10b981">
  <title>Bunny Quest - Carrot Puzzle Game</title>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      height: 100%;
      background: linear-gradient(to bottom, #dcfce7, #bbf7d0);
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      overflow: hidden;
      -webkit-user-select: none;
      user-select: none;
      touch-action: none;
    }
    
    .container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      background: transparent;
    }
    
    .header {
      padding: 12px 16px 8px;
      flex-shrink: 0;
    }
    
    .title {
      font-size: 24px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 8px;
      color: #166534;
    }
    
    .stats {
      background: white;
      border-radius: 8px;
      padding: 8px 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      max-width: 500px;
      margin: 0 auto;
    }
    
    .stats-row {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
    }
    
    .level { color: #166534; font-weight: 600; }
    .carrots { color: #ea580c; font-weight: 600; }
    .moves { color: #6b7280; }
    
    .game-area {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      min-height: 0;
    }
    
    .game-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .grid {
      border: 4px solid #92400e;
      border-radius: 8px;
      overflow: hidden;
      background: #f0fdf4;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      touch-action: none;
    }
    
    .grid-row {
      display: flex;
    }
    
    .cell {
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #bbf7d0;
    }
    
    .wall { background: #92400e; }
    
    .box {
      background: #d97706;
      border: 2px solid #92400e;
      border-radius: 4px;
    }
    
    .hint {
      margin-top: 12px;
      background: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      color: #374151;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .controls {
      padding: 16px;
      flex-shrink: 0;
    }
    
    .complete-banner {
      background: #d1fae5;
      border: 2px solid #10b981;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .complete-title {
      font-size: 20px;
      font-weight: bold;
      color: #166534;
      margin-bottom: 4px;
    }
    
    .complete-moves {
      font-size: 14px;
      color: #16a34a;
      margin-bottom: 8px;
    }
    
    .complete-msg {
      font-size: 14px;
      color: #166534;
      font-weight: 600;
    }
    
    button {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      transition: transform 0.1s;
    }
    
    button:active {
      transform: scale(0.95);
    }
    
    .btn-restart {
      background: #3b82f6;
      color: white;
    }
    
    .btn-next {
      background: #10b981;
      color: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title">üê∞ Bunny Quest</div>
      <div class="stats">
        <div class="stats-row">
          <div class="level">Lv <span id="levelNum">1</span></div>
          <div class="carrots">ü•ï <span id="carrotCount">0</span>/<span id="carrotTotal">0</span></div>
          <div class="moves">Moves: <span id="moveCount">0</span></div>
        </div>
      </div>
    </div>
    
    <div class="game-area">
      <div class="game-wrapper">
        <div id="grid" class="grid"></div>
        <div class="hint">üëÜ Swipe to move</div>
      </div>
    </div>
    
    <div class="controls">
      <div id="completeBanner" style="display: none;" class="complete-banner">
        <div class="complete-title">üéâ Complete!</div>
        <div class="complete-moves"><span id="finalMoves">0</span> moves</div>
        <div id="completeMsg" class="complete-msg"></div>
        <button id="nextBtn" class="btn-next" style="display: none;">
          Next Level ‚Üí
        </button>
      </div>
      <button id="restartBtn" class="btn-restart">‚Üª Restart</button>
    </div>
  </div>

  <script>
    const EMPTY = 0, WALL = 1, CARROT = 2, RABBIT = 3, BOX = 4;
    
    const levels = [
      {
        grid: [
          [1,1,1,1,1,1],
          [1,3,0,0,2,1],
          [1,0,1,0,0,1],
          [1,2,0,1,2,1],
          [1,0,0,0,0,1],
          [1,1,1,1,1,1]
        ],
        totalCarrots: 3
      },
      {
        grid: [
          [1,1,1,1,1,1,1],
          [1,3,0,4,0,2,1],
          [1,0,1,1,1,0,1],
          [1,2,0,0,0,0,1],
          [1,0,1,4,1,2,1],
          [1,0,0,0,0,0,1],
          [1,1,1,1,1,1,1]
        ],
        totalCarrots: 3
      },
      {
        grid: [
          [1,1,1,1,1,1,1,1],
          [1,3,0,0,4,0,2,1],
          [1,0,1,0,1,0,0,1],
          [1,0,0,4,0,1,0,1],
          [1,2,1,0,0,0,2,1],
          [1,0,0,0,1,4,0,1],
          [1,2,0,0,0,0,0,1],
          [1,1,1,1,1,1,1,1]
        ],
        totalCarrots: 4
      }
    ];
    
    let currentLevel = 0;
    let grid = [];
    let rabbitPos = {x: 0, y: 0};
    let carrotsCollected = 0;
    let moves = 0;
    let levelComplete = false;
    let cellSize = 40;
    let touchStart = null;
    
    function calculateCellSize() {
      const level = levels[currentLevel];
      const gridWidth = level.grid[0].length;
      const gridHeight = level.grid.length;
      const availableHeight = window.innerHeight - 220;
      const availableWidth = window.innerWidth - 32;
      const widthBasedSize = Math.floor(availableWidth / gridWidth);
      const heightBasedSize = Math.floor(availableHeight / gridHeight);
      cellSize = Math.min(Math.max(Math.min(widthBasedSize, heightBasedSize, 70), 30));
    }
    
    function initLevel(levelIndex) {
      currentLevel = levelIndex;
      const level = levels[levelIndex];
      grid = level.grid.map(row => [...row]);
      
      for (let y = 0; y < grid.length; y++) {
        for (let x = 0; x < grid[y].length; x++) {
          if (grid[y][x] === RABBIT) {
            rabbitPos = {x, y};
            grid[y][x] = EMPTY;
          }
        }
      }
      
      carrotsCollected = 0;
      moves = 0;
      levelComplete = false;
      
      calculateCellSize();
      render();
    }
    
    function canMove(x, y) {
      return y >= 0 && y < grid.length && x >= 0 && x < grid[0].length && grid[y][x] !== WALL;
    }
    
    function moveRabbit(dx, dy) {
      if (levelComplete) return;
      
      const newX = rabbitPos.x + dx;
      const newY = rabbitPos.y + dy;
      
      if (!canMove(newX, newY)) return;
      
      if (grid[newY][newX] === BOX) {
        const pushX = newX + dx;
        const pushY = newY + dy;
        if (!canMove(pushX, pushY) || grid[pushY][pushX] === BOX) return;
        grid[newY][newX] = EMPTY;
        grid[pushY][pushX] = BOX;
      }
      
      if (grid[newY][newX] === CARROT) {
        grid[newY][newX] = EMPTY;
        carrotsCollected++;
        if (carrotsCollected === levels[currentLevel].totalCarrots) {
          levelComplete = true;
        }
      }
      
      rabbitPos = {x: newX, y: newY};
      moves++;
      render();
    }
    
    function render() {
      const gridEl = document.getElementById('grid');
      gridEl.innerHTML = '';
      gridEl.style.width = grid[0].length * cellSize + 'px';
      gridEl.style.height = grid.length * cellSize + 'px';
      
      for (let y = 0; y < grid.length; y++) {
        const rowEl = document.createElement('div');
        rowEl.className = 'grid-row';
        for (let x = 0; x < grid[y].length; x++) {
          const cell = document.createElement('div');
          cell.className = 'cell';
          cell.style.width = cellSize + 'px';
          cell.style.height = cellSize + 'px';
          
          if (rabbitPos.x === x && rabbitPos.y === y) {
            const size = cellSize > 50 ? '30px' : cellSize > 40 ? '24px' : cellSize > 30 ? '20px' : '16px';
            cell.innerHTML = `<span style="font-size: ${size}">üê∞</span>`;
          } else if (grid[y][x] === WALL) {
            cell.className += ' wall';
          } else if (grid[y][x] === CARROT) {
            const size = cellSize > 50 ? '30px' : cellSize > 40 ? '24px' : cellSize > 30 ? '20px' : '16px';
            cell.innerHTML = `<span style="font-size: ${size}">ü•ï</span>`;
          } else if (grid[y][x] === BOX) {
            const boxSize = Math.floor(cellSize * 0.65);
            cell.innerHTML = `<div class="box" style="width: ${boxSize}px; height: ${boxSize}px;"></div>`;
          }
          
          rowEl.appendChild(cell);
        }
        gridEl.appendChild(rowEl);
      }
      
      document.getElementById('levelNum').textContent = currentLevel + 1;
      document.getElementById('carrotCount').textContent = carrotsCollected;
      document.getElementById('carrotTotal').textContent = levels[currentLevel].totalCarrots;
      document.getElementById('moveCount').textContent = moves;
      
      const banner = document.getElementById('completeBanner');
      if (levelComplete) {
        banner.style.display = 'block';
        document.getElementById('finalMoves').textContent = moves;
        const nextBtn = document.getElementById('nextBtn');
        const msg = document.getElementById('completeMsg');
        if (currentLevel === levels.length - 1) {
          nextBtn.style.display = 'none';
          msg.textContent = 'All levels complete! üèÜ';
        } else {
          nextBtn.style.display = 'block';
          msg.textContent = '';
        }
      } else {
        banner.style.display = 'none';
      }
    }
    
    document.getElementById('restartBtn').addEventListener('click', () => initLevel(currentLevel));
    document.getElementById('nextBtn').addEventListener('click', () => {
      if (currentLevel < levels.length - 1) initLevel(currentLevel + 1);
    });
    
    const gridEl = document.getElementById('grid');
    gridEl.addEventListener('touchstart', e => {
      e.preventDefault();
      touchStart = {x: e.touches[0].clientX, y: e.touches[0].clientY};
    });
    
    gridEl.addEventListener('touchend', e => {
      if (!touchStart) return;
      const touch = e.changedTouches[0];
      const dx = touch.clientX - touchStart.x;
      const dy = touch.clientY - touchStart.y;
      if (Math.abs(dx) > Math.abs(dy)) {
        if (Math.abs(dx) > 20) moveRabbit(dx > 0 ? 1 : -1, 0);
      } else {
        if (Math.abs(dy) > 20) moveRabbit(0, dy > 0 ? 1 : -1);
      }
      touchStart = null;
    });
    
    window.addEventListener('resize', () => {
      calculateCellSize();
      render();
    });
    
    initLevel(0);
  </script>
</body>
</html>
